<!DOCTYPE html>
<html lang="en">

<head>
    <meta property="og:title" content="365Connect Community">
    <meta property="og:description"
        content="365Connect is a community dedicated to promoting and advancing the adoption of Microsoft D365 and Power Platform technologies. Our primary goal is to foster a supportive environment where individuals can learn, teach, and collaborate on all things related to these powerful tools. Whether you're an experienced user or just starting out, we welcome members from any part of the globe to join us in our mission to promote and develop this community.">
    <meta property="og:image" content="https://365connectcommunity.github.io/preview.png">
    <meta property="og:url" content="https://365connectcommunity.github.io/">

    <!---->
    <!-- <meta charset="utf-8"> -->
    <link rel="icon" type="image/x-icon" href="./favicon.ico">
    <!-- <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
    <meta name="description"
        content="365Connect is a community dedicated to promoting and advancing the adoption of Microsoft D365 and Power Platform technologies. Our primary goal is to foster a supportive environment where individuals can learn, teach, and collaborate on all things related to these powerful tools. Whether you're an experienced user or just starting out, we welcome members from any part of the globe to join us in our mission to promote and develop this community.">
    <meta name="author" content="Shaheer Ahmad"> -->
    <link href="https://fonts.googleapis.com/css?family=Montserrat:100,200,300,400,500,600,700,800,900"
        rel="stylesheet">


    <!-- Bootstrap core CSS -->
    <link href="vendor/bootstrap/css/bootstrap.min.css" rel="stylesheet">

    <!-- Additional CSS Files -->
    <link rel="stylesheet" href="assets/css/fontawesome.css">
    <link rel="stylesheet" href="assets/css/templatemo-grad-school.css">
    <link rel="stylesheet" href="assets/css/owl.css">
    <link rel="stylesheet" href="assets/css/lightbox.css">
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Certificates | 365Connect Community</title>
    <link rel="stylesheet" href="styles.css">

    <script src="vendor/jquery/jquery.min.js"></script>
    <link rel="stylesheet" href="https://code.jquery.com/jquery-3.3.1.slim.min.js">
    <link rel="stylesheet"
        href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/4.3.1/js/bootstrap.bundle.min.js">
    <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/font-awesome/4.7.0/css/font-awesome.min.css">

</head>

<body>
    <header class="main-header clearfix" role="header">
        <div class="logo">
            <img id="header-logo" style="height: 50px; margin-right: 20px;" src="./favicon.ico">
            <a href="./index.html" style="text-decoration: none; font-size: 29px !important;"><em></em><span
                    style="color: #feb70c;">3</span><span style="color: #5ea904;">6</span><span
                    style="color: #04a0ed;">5</span><span style="color: white;">C</span><span
                    style="text-transform: lowercase;">onnect</span></a><!--#ce392c;-->
        </div>
        <a href="#menu" class="menu-link"><i class="fa fa-bars"></i></a>
        <nav id="menu" class="main-nav" role="navigation">
            <ul class="main-menu">
                <li><a href="./index.html">Home</a></li>
                <li class="has-submenu"><a href="#">Our Family</a>
                    <ul class="sub-menu">
                        <li><a href="./team-members.html" class="external">Contributors</a></li>
                        <li><a href="./community-members.html" class="external">Members</a></li>
                        <li><a href="./become-contributor.html" class="external">Become Contributor</a></li>
                        <li><a href="./signup.html" class="external">Become Member</a></li>
                    </ul>
                </li>
                <li class="has-submenu"><a href="#">Resources</a>
                    <ul class="sub-menu">
                        <li><a href="./events.html" class="external">Events</a></li>
                        <li><a href="./blog.html" class="external">Blogs</a></li>
                        <li><a href="./courses.html" class="external">Courses</a></li>
            <li><a href="./sample-soltutions.html" class="external">Sample Solutions</a></li>
                    </ul>
                </li>
                <li class="has-submenu"><a href="#">Contact Us</a>
                    <ul class="sub-menu">
                        <li><a href="./support.html" class="external">Get Support</a></li>
                        <li><a href="./index.html" class="external">Seek Guidance</a></li>
                        <li><a href="./our-socials.html" class="external">Our Socials</a></li>
                    </ul>
                </li>
                <li><a href="https://365connectcommunity.azurewebsites.net/" class="external" id="cartimg"></a></li>
            </ul>
        </nav>
    </header>
    <div id="imagePopup" class="image-popup">
        <span class="image-close" onclick="closePopup()">&times;</span>
        <img src="" alt="Profile Picture" id="previewImage">
    </div>
    <!-- name popup -->
    <div id="name-namePopup" class="file-popup-overlay" style="display: none;">
        <div class="file-popup-container">
            <h2>Update Name</h2>
            <label class="name-label" for="name-firstNameInput">First Name:</label>
            <input type="text" id="name-firstNameInput" class="form-control" />
            <label class="name-label" for="name-lastNameInput">Last Name:</label>
            <input type="text" id="name-lastNameInput" class="form-control" /><br>
            <button id="name-updateNameButton" class="file-btn">Update</button>
            <button id="name-closeNamePopup" class="file-btn cancel">Close</button>
        </div>
    </div>
    <!-- The file upload popup -->
    <div id="file-fileUploadPopup" class="file-popup-overlay" style="display: none;">
        <div class="file-popup-container">
            <h2>Change Profile Picture</h2>
            <label class="file-label" for="file-fileInput">Select File</label>
            <input type="file" id="file-fileInput" class="file-input" accept="image/jpeg, image/png, image/gif" />
            <p id="file-selectedFileName" style="color: black !important;"></p>
            <button id="file-uploadButton" class="file-btn">Upload</button>
            <button id="file-closePopup" class="file-btn cancel">Cancel</button>
        </div>
    </div>

    <div class="loading" id="loading">Loading&#8230;</div>
    <div class="header" style="height: 50vh !important;">


        <div class="sides">
            <!-- search-->
            <a href="./index.html" class="logo">ðŸ”™ </a>
        </div>


        <div class="sides">
            <a href="#" class="menu" style=" display: none;"> </a>


        </div>
        <div class="info" id="info">
            <div class="meta" style="margin-top: -60px !important;">
                <a href="" id="file-openPopup1" target="_b" class="author1"></a>
                <div class="edit-icon">
                    <i class="fa fa-pencil" style="font-size:20px;" id="file-openPopup"></i>
                    <!-- You can replace this with the appropriate icon class or image -->
                </div>
            </div>
            <h4><a href="#category"></a></h4>
        </div>
    </div>

    <section class="content">
        <center>
            <h2 style="color: white !important;">My Certificates</h2>
            <hr style=" border: 2px solid white; border-radius: 20px;">
        </center>
        <ul id="event-list1"></ul><br>
        <div class="row"></div>
        <div class="message" id="message1">
        </div>
        <!-- Popup and overlay for event details -->


    </section>
    <!-- Site footer -->
    <footer>
        <div class="container">
            <div class="row">
                <div class="col-md-12">
                    <p><i class="fa fa-copyright"></i> Copyright 2023 by 365Connect Community

                        | Design: <a href="https://www.linkedin.com/in/shaheer-ahmad-ch" rel="sponsored"
                            target="_parent">Shaheer Ahmad</a></p>
                </div>
            </div>
        </div>
    </footer>
    <script>
        var signedIn = localStorage.getItem("name") == null || localStorage.getItem("email") == null || localStorage.getItem("email") == 'null' || localStorage.getItem("name") == 'null' || localStorage.getItem("email") == '' || localStorage.getItem("name") == '' || localStorage.getItem("email") == undefined || localStorage.getItem("name") == undefined;
        function generateProfileSubMenu() {
            if (signedIn) {
                window.location.href = './login.html';
                return `
    <li class="has-submenu active">
      <img id= "myprofilepic" src="./assets/images/icons8-account-64.png" style="width:45px;height:45px;border-radius:200px;border:0px solid orange;">
      <ul class="sub-menu">
        <li><a href="./login.html" class="external">Sign In</a></li>
        <li><a href="./signup.html" class="external">Sign Up</a></li>
      </ul>
    </li>
  `;
            }
            else {
                return `
    <li class="has-submenu active">
      <img id= "myprofilepic" src="data:image/png;base64,${localStorage.getItem("image")}" style="width:45px;height:45px;border-radius:200px;border:2px solid orange;">
      <ul class="sub-menu">
        <li><a href="./login.html" class="external">${localStorage.firstname}</a></li>
        <li><a href="./login.html" class="external">My Registrations</a></li>
        <li><a href="./my-certificates.html" class="external">My Certificates</a></li>
        <li><a href="./index.html" class="external" id="logout">Sign Out</a></li>
      </ul>
    </li>
  `;
            }
        }


        // Add a click event listener


        // Find the parent ul element with the class "main-menu"
        const mainMenu = document.querySelector('.main-menu');

        // Append the "Profile" submenu HTML to the mainMenu
        mainMenu.insertAdjacentHTML('beforeend', generateProfileSubMenu());
        const myLink = document.getElementById('logout');
        if (document.getElementById('logout'))
            myLink.addEventListener('click', function (event) {
                // Prevent the default behavior (e.g., navigating to the href URL)
                event.preventDefault();

                // You can also perform other actions here
                localStorage.setItem("name", null);
                localStorage.setItem("email", null);
                localStorage.setItem("image", null);
                window.location.href = './index.html';

            });
        // Get the elements
        const openPopupButton = document.getElementById('file-openPopup1');
        openPopupButton.style.border = "5px solid orange";
        const popup = document.getElementById('imagePopup');
        const previewImage = document.getElementById('previewImage');

        // Open the popup and display the image
        openPopupButton.addEventListener('click', function () {
            event.preventDefault();
            const backgroundImageURL = window.getComputedStyle(openPopupButton).backgroundImage;
            const imageURL = backgroundImageURL.replace('url("', '').replace('")', '');

            popup.style.display = 'block';
            previewImage.src = imageURL;
        });

        // Close the popup
        function closePopup() {
            popup.style.display = 'none';
        }

        // Close the popup when clicking outside of the image
        window.addEventListener('click', function (event) {
            if (event.target === popup) {
                closePopup();
            }
        });

        var crmUrl = "https://dev-shaheer.crm5.dynamics.com/";
        const authorElement = document.querySelector('.author1');
        console.log(localStorage.getItem("image"))
        if (localStorage.getItem("image") == '' || localStorage.getItem("image") == null || localStorage.getItem("image") == 'null' || localStorage.getItem("image") == 'undefined') {
            authorElement.style.background = 'url(https://static.vecteezy.com/system/resources/thumbnails/005/545/335/small/user-sign-icon-person-symbol-human-avatar-isolated-on-white-backogrund-vector.jpg) center no-repeat';
        }
        else {
            authorElement.style.background = `url(data:image/png;base64,${localStorage.getItem("image")}) center no-repeat`;
        }


        // Change the background image URL


        // Optionally, you can also specify background size and box shadow here
        authorElement.style.backgroundSize = 'cover';
        authorElement.style.boxShadow = '0 2px 3px rgba(0, 0, 0, 0.3)';
        const sidesDiv = document.querySelector(".sides");
        const anchorElement1 = document.createElement("a");

        // Set the anchor's attributes
        anchorElement1.href = "./login.html";
        anchorElement1.className = "logo";
        anchorElement1.style.marginTop = "0px";
        anchorElement1.style.height = "40px";
        anchorElement1.textContent = "Sign Out";
        anchorElement1.addEventListener("click", function (event) {
            event.preventDefault();
            localStorage.setItem("name", null);
            localStorage.setItem("email", null);
            localStorage.setItem("image", null);
            window.location.href = "./index.html";
        });
        sidesDiv.appendChild(anchorElement1);
        // Wrap your code in an async function
        async function fetchDataAndDisplay() {
            const url_string = window.location.href;
            const url = new URL(url_string);
            //   const email = url.searchParams.get("email");
            //   const fullname = url.searchParams.get("name");
            const email = localStorage.getItem("email");
            const fullname = localStorage.getItem("name");
            const heading = document.getElementById("info");
            const text = document.createElement("h2");
            const textsds = document.createElement("p");
            text.textContent = "Welcome, " + fullname;
            text.id = "element-fullname";
            text.innerHTML = ` ${fullname} <i class="fa fa-pencil" style="font-size:20px;" id="name-openPopup"></i>`;
            textsds.textContent = email;
            text.style.padding = "0px"
            heading.appendChild(text);
            heading.appendChild(textsds);
            // Create headers with the email value
            const myHeaders = new Headers();
            myHeaders.append("email", email);

            const requestOptions = {
                method: 'GET',
                headers: myHeaders,
                redirect: 'follow'
            };
            ///done

            const apiUrl = "https://prod-211.westeurope.logic.azure.com:443/workflows/50594cb1227741739216cf63fcdec0af/triggers/manual/paths/invoke?api-version=2016-06-01&sp=%2Ftriggers%2Fmanual%2Frun&sv=1.0&sig=UO7we7Jqp5hQiuTNZdjzZHTW3ULsb_WTL3yZCf6wp6k";

            try {
                const events = await fetchEventData(apiUrl, requestOptions);

                // Display event list
                displayEventList(events);
            } catch (error) {
                console.log(error)
            } finally {
                document.getElementById("loading").style.display = "none";
            }

            // Function to fetch event data from the API
            async function fetchEventData(apiUrl, requestOptions) {
                try {
                    const response = await fetch(apiUrl, requestOptions);

                    if (response.status === 200) {
                        const data = await response.json();
                        return data;
                    } else {
                        showError1("No Certificates Recieved", "warning");
                    }
                } catch (error) {
                    showError1("No Certificates Revieved", "warning");
                }
            }


            // Function to create and display the event list
            function displayEventList(events) {
    const eventList1 = document.getElementById("event-list1");

    events.forEach(event => {
        const listItem = document.createElement("li");
        listItem.className = "event-item";

        // Create a card element
        const cardDiv = createCertificateCard(event);

        // Append the card to the event list
        eventList1.appendChild(cardDiv);
    });
}

            // Function to convert hours to days
            
        }
        function showError1(alert, alertType) {
            var message = document.querySelector('.row');
            var messagetext = document.createElement("div");
            messagetext.classList.add("alert")
            messagetext.classList.add("alert-" + alertType)
            messagetext.textContent = alert;
            message.appendChild(messagetext);
        }

        // Call the async function to initiate the asynchronous operation
        fetchDataAndDisplay();


        function createCertificateCard(certificate) {
    // Create a div element with the "card" class
    const cardDiv = document.createElement('div');
    cardDiv.style.boxShadow = "rgba(0, 0, 0, 0.24) 0px 3px 8px";
    cardDiv.classList.add('card', 'd-flex', 'flex-column');
    cardDiv.style.minHeight = '350px';
    cardDiv.style.margin = '10px';
    cardDiv.style.border = "none";
    cardDiv.style.marginBottom = "20px";

    // Create a div element with the "card-body" class
    const cardBodyDiv = document.createElement('div');
    cardBodyDiv.classList.add('card-body', 'd-flex', 'flex-column', 'align-items-center', 'justify-content-center');
    cardBodyDiv.style.backgroundColor = "#202124";
    cardBodyDiv.style.borderColor = "#202124 !important";

    // Create a title element
    const titleElement = document.createElement('h2');
    titleElement.classList.add('card-title');
    titleElement.style.backgroundColor = "#131e32";
    titleElement.style.color = "white";
    titleElement.style.height = "150px";
    titleElement.textContent = certificate["sa_eventname"];

    // Create a paragraph element for certificate details
    const detailsElement = document.createElement('p');
    detailsElement.classList.add('card-text');
    detailsElement.style.textAlign = "center";
    detailsElement.innerHTML = `<b>Event Date: </b>${certificate["sa_eventdate"]}<br><b>Certificate Type: </b>${certificate["sa_certificatetype"]}<br><b>Recipient: </b>${certificate["sa_recipientname"]}`;

    // Create a verification button
    const verificationButton = document.createElement('button');
    verificationButton.classList.add('view-details');
    verificationButton.style.backgroundColor = "orange";
    verificationButton.style.margin = "5px";
    verificationButton.style.textAlign = "center"
    verificationButton.textContent = 'Verify Certificate';
    verificationButton.addEventListener('click', () => {
        window.open(certificate["sa_verificationlink"], '_blank');
    });

    // Create a download button
    const downloadButton = document.createElement('button');
    downloadButton.classList.add('view-details');
    downloadButton.style.margin = "5px";
    downloadButton.style.textAlign = "center"
    downloadButton.style.backgroundColor = "orange";
    downloadButton.textContent = 'Download Certificate';
    downloadButton.addEventListener('click', () => {
        window.open(certificate["sa_downloadlink"], '_blank');
    });

    // Append elements to build the structure
    cardBodyDiv.appendChild(titleElement);
    cardBodyDiv.appendChild(detailsElement);
    cardBodyDiv.appendChild(verificationButton);
    cardBodyDiv.appendChild(downloadButton);
    cardDiv.appendChild(cardBodyDiv);

    // Return the created card element
    return cardDiv;
}




        ////////
        const fileOpenPopupButton = document.getElementById('file-openPopup');
        const fileUploadPopup = document.getElementById('file-fileUploadPopup');
        const fileInput = document.getElementById('file-fileInput');
        const uploadButton = document.getElementById('file-uploadButton');
        const closePopupButton = document.getElementById('file-closePopup');
        const selectedFileName = document.getElementById('file-selectedFileName');

        // Prevent default navigation behavior
        fileOpenPopupButton.addEventListener('click', (event) => {
            event.preventDefault();
            fileUploadPopup.style.display = 'flex';
        });

        closePopupButton.addEventListener('click', () => {
            fileUploadPopup.style.display = 'none';
        });

        fileInput.addEventListener('change', () => {
            if (fileInput.files.length > 0) {
                selectedFileName.textContent = `Selected File: ${fileInput.files[0].name}`;
            } else {
                selectedFileName.textContent = '';
            }
        });

        uploadButton.addEventListener('click', () => {
            document.getElementById("loading").style.display = "block";
            const selectedFile = fileInput.files[0];
            const userEmail = localStorage.getItem("email"); // Replace with the actual user's email

            if (selectedFile) {
                const formData = new FormData();
                formData.append('contents', selectedFile);

                const headers = new Headers();
                headers.append('email', userEmail);

                // Add other headers as needed

                // Replace 'your-api-endpoint' with the actual API endpoint
                fetch('https://prod-158.westeurope.logic.azure.com:443/workflows/b34d7018c77343d5be0987e9b18c7beb/triggers/manual/paths/invoke?api-version=2016-06-01&sp=%2Ftriggers%2Fmanual%2Frun&sv=1.0&sig=urhseaxJ-BK6cO_N2657WEjEXnXn5y9862IiGrkA05A', {
                    method: 'POST',
                    body: formData,
                    headers: headers
                })
                    .then(response => {
                        if (!response.ok) {
                            throw new Error('Network response was not ok');
                        }
                        return response.json();
                        document.getElementById("loading").style.display = "none";
                    })
                    .then(data => {
                        let newimage_url = data.body.entityimage;
                        authorElement.style.background = `url(data:image/png;base64,${data.body.entityimage}) center no-repeat`;
                        localStorage.setItem("image", data.body.entityimage)
                        fileUploadPopup.style.display = 'none';
                        document.getElementById("loading").style.display = "none";
                    })
                    .catch(error => {
                        console.error('Error:', error);
                        document.getElementById("loading").style.display = "none";
                    });
            } else {
                alert('Please select a file to upload.');
                document.getElementById("loading").style.display = "none";
            }
        });

        const nameOpenPopupButton = document.getElementById('name-openPopup');
        const namePopup = document.getElementById('name-namePopup');
        const firstNameInput = document.getElementById('name-firstNameInput');
        const lastNameInput = document.getElementById('name-lastNameInput');
        const updateNameButton = document.getElementById('name-updateNameButton');
        const closeNamePopupButton = document.getElementById('name-closeNamePopup');
        updateNameButton.style.display = "none";

        // Prevent default navigation behavior
        nameOpenPopupButton.addEventListener('click', (event) => {
            event.preventDefault();
            namePopup.style.display = 'flex';
            document.getElementById("name-firstNameInput").value = localStorage.firstname;
            document.getElementById("name-lastNameInput").value = localStorage.lastname;
        });

        firstNameInput.addEventListener('change', () => {
            // This function will be called when the First Name input value changes
            if (firstNameInput.value == localStorage.firstname && lastNameInput.value == localStorage.lastname) {
                updateNameButton.style.display = "none";
            }
            else if (firstNameInput.value != localStorage.firstname) {
                updateNameButton.style.display = "inline";
            }
            else if (firstNameInput.value != localStorage.lastname) {
                updateNameButton.style.display = "inline";
            }

        });

        lastNameInput.addEventListener('change', () => {
            // This function will be called when the Last Name input value changes
            if (firstNameInput.value == localStorage.firstname && lastNameInput.value == localStorage.lastname) {
                updateNameButton.style.display = "none";
            }
            else if (firstNameInput.value != localStorage.firstname) {
                updateNameButton.style.display = "inline";
            }
            else if (firstNameInput.value != localStorage.lastname) {
                updateNameButton.style.display = "inline";
            }
        });

        closeNamePopupButton.addEventListener('click', () => {
            namePopup.style.display = 'none';
        });

        updateNameButton.addEventListener('click', () => {

            document.getElementById("loading").style.display = "block";
            const firstName = firstNameInput.value;
            const lastName = lastNameInput.value;
            if (firstNameInput.value != localStorage.firstname || lastNameInput.value != localStorage.lastname) {
                document.getElementById("element-fullname").innerHTML = ` ${firstName + " " + lastName} <i class="fa fa-pencil" style="font-size:20px;" id="name-openPopup"></i>`

                var myHeaders = new Headers();
                myHeaders.append("email", "shaheer.ashraf@live.com");
                myHeaders.append("firstname", firstName);
                myHeaders.append("lastname", lastName);

                var requestOptions = {
                    method: 'POST',
                    headers: myHeaders,
                    redirect: 'follow'
                };

                fetch("https://prod-191.westeurope.logic.azure.com:443/workflows/c2394956d13d4608be0fa6bc87404282/triggers/manual/paths/invoke?api-version=2016-06-01&sp=%2Ftriggers%2Fmanual%2Frun&sv=1.0&sig=Egsd_HYbC_jOldOC9vX6jaAku_1Ko5ljeAe7h5Fgk7c", requestOptions)
                    .then(response => response.text())
                    .then(result => {
                        namePopup.style.display = 'none';
                        document.getElementById("loading").style.display = "none";
                        localStorage.getItem("firstname", firstName);
                        localStorage.getItem("lastname", lastName);
                    })
                    .catch(error => console.log('error', error));
                // Close the popup
            } else {
                updateNameButton.style.display = 'none';
                document.getElementById("loading").style.display = "none";
            }
        });

        if (screen.height > screen.width) {
            document.getElementById("header-logo").hidden = true;
            document.querySelector(".menu-link").classList.remove("active");
            document.querySelector(".main-nav").classList.remove("active");
            document.querySelector(".main-nav").style.overflow = 'scroll';
            document.querySelector(".main-nav").style.height = '60vh';
            document.querySelector(".main-nav").style.minHeight = '60vh';
            document.querySelector(".main-menu").hidden = true;
            document.querySelector(".fa").addEventListener("click", function () {
                if (document.querySelector(".menu-link").classList.value.includes("active")) {
                    document.querySelector(".menu-link").classList.remove("active");
                    document.querySelector(".main-nav").classList.remove("active");
                    document.querySelector(".main-menu").hidden = false;
                }
                else {
                    document.querySelector(".menu-link").classList.add("active");
                    document.querySelector(".main-nav").classList.add("active");
                    document.querySelector(".main-menu").hidden = true;
                }
            })
        }
        if (screen.height > screen.width) {
      document.getElementById("myprofilepic").hidden = true;
    }
    if (localStorage.getItem("image") == '' || localStorage.getItem("image") == null || localStorage.getItem("image") == 'null' || localStorage.getItem("image") == 'undefined') {
      document.getElementById("myprofilepic").src = './assets/images/icons8-account-64.png';
    }
    </script>


</body>

</html>
